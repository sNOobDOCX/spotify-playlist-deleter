
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spotify Playlist Deleter</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .playlist { margin: 10px 0; }
    button { margin-top: 20px; padding: 10px 15px; font-size: 16px; }
  </style>
</head>
<body>
  <h2>Spotify Playlist Deleter</h2>
  <button onclick="login()">Login with Spotify</button>
  <div id="playlists" style="margin-top:20px;"></div>
  <button onclick="deleteSelected()">Delete Selected Playlists</button>

  <script>
    const client_id = '39ecbf89a548493ea7e831739da1a283';
    const redirect_uri = window.location.origin + window.location.pathname;

    function login() {
      const scopes = 'playlist-read-private playlist-modify-private playlist-modify-public';
      const authUrl = \`https://accounts.spotify.com/authorize?client_id=\${client_id}&response_type=token&redirect_uri=\${encodeURIComponent(redirect_uri)}&scope=\${encodeURIComponent(scopes)}\`;
      window.location = authUrl;
    }

    function getTokenFromUrl() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      return params.get('access_token');
    }

    async function fetchPlaylists(token) {
      let playlists = [];
      let url = 'https://api.spotify.com/v1/me/playlists?limit=50';
      while (url) {
        const res = await fetch(url, { headers: { Authorization: 'Bearer ' + token } });
        const data = await res.json();
        playlists = playlists.concat(data.items);
        url = data.next;
      }
      return playlists;
    }

    function showPlaylists(playlists) {
      const container = document.getElementById('playlists');
      container.innerHTML = '';
      playlists.forEach((pl, i) => {
        const div = document.createElement('div');
        div.className = 'playlist';
        div.innerHTML = \`
          <input type="checkbox" id="pl\${i}" data-id="\${pl.id}" data-owned="\${pl.owner.id === pl.href.split('/users/')[1].split('/')[0]}"/>
          <label for="pl\${i}">\${pl.name}</label>
        \`;
        container.appendChild(div);
      });
    }

    async function deleteSelected() {
      const token = getTokenFromUrl();
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      for (const cb of checkboxes) {
        const id = cb.getAttribute('data-id');
        const owned = cb.getAttribute('data-owned') === 'true';
        if (owned) {
          await fetch(\`https://api.spotify.com/v1/playlists/\${id}/followers\`, {
            method: 'DELETE',
            headers: { Authorization: 'Bearer ' + token }
          });
          console.log('Deleted playlist:', id);
        } else {
          console.log('Skipped (not owner):', id);
        }
      }
      alert('Selected playlists deleted (if you owned them). Reload the page to refresh.');
    }

    window.onload = async () => {
      const token = getTokenFromUrl();
      if (token) {
        const playlists = await fetchPlaylists(token);
        showPlaylists(playlists);
      }
    };
  </script>
</body>
</html>
